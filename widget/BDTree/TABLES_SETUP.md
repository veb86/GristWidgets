# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–±–ª–∏—Ü –≤ Grist –¥–ª—è –≤–∏–¥–∂–µ—Ç–∞ BDTree

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

–í–∏–¥–∂–µ—Ç BDTree —Ç—Ä–µ–±—É–µ—Ç –Ω–∞–ª–∏—á–∏—è **–¥–≤—É—Ö —Ç–∞–±–ª–∏—Ü** –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ Grist:

1. `Device_groups`
2. `SYSTEM`

**–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:** –ò–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü **—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É**!

---

## üìã –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã Device_groups

### 1.1 –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É

1. –í Grist –Ω–∞–∂–º–∏—Ç–µ **+** (Add New) ‚Üí **Add New Table**
2. –ù–∞–∑–æ–≤–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É: `Device_groups` (—Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã)

### 1.2 –î–æ–±–∞–≤—å—Ç–µ —Å—Ç–æ–ª–±—Ü—ã

| –°—Ç–æ–ª–±–µ—Ü    | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–ø–∏—Å–∞–Ω–∏–µ                          | –ü—Ä–∏–º–µ—Ä |
| ---------- | ---------- | --------------------------------- | ------ |
| id         | Int        | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≥—Ä—É–ø–ø—ã (–∫–ª—é—á)       | 1      |
| manualSort | Int        | –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏                | 1      |
| parent_id  | Int        | –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –≥—Ä—É–ø–ø–∞ (0 = –∫–æ—Ä–Ω–µ–≤–∞—è)| 0      |
| code       | Text       | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–¥ –≥—Ä—É–ø–ø—ã            | lighting |
| name       | Text       | –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –≥—Ä—É–ø–ø—ã           | –û—Å–≤–µ—â–µ–Ω–∏–µ |

### 1.3 –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö

| id | manualSort | parent_id | code       | name                       |
|----|------------|-----------|------------|----------------------------|
| 1  | 1          | 0         | lighting   | –û—Å–≤–µ—â–µ–Ω–∏–µ                  |
| 2  | 2          | 0         | protection | –ó–∞—â–∏—Ç–∞                     |
| 3  | 3          | 0         | cables     | –ö–∞–±–µ–ª–∏                     |
| 4  | 1          | 1         | luminaires | –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏                |
| 5  | 2          | 1         | lamps      | –õ–∞–º–ø—ã                      |
| 6  | 1          | 2         | breakers   | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–∏ |

**–ò–µ—Ä–∞—Ä—Ö–∏—è:**
```
–û—Å–≤–µ—â–µ–Ω–∏–µ (1)
 ‚îú‚îÄ –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏ (4)
 ‚îî‚îÄ –õ–∞–º–ø—ã (5)

–ó–∞—â–∏—Ç–∞ (2)
 ‚îî‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–∏ (6)

–ö–∞–±–µ–ª–∏ (3)
```

---

## üìã –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã SYSTEM

### 2.1 –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É

1. –í Grist –Ω–∞–∂–º–∏—Ç–µ **+** (Add New) ‚Üí **Add New Table**
2. –ù–∞–∑–æ–≤–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É: `SYSTEM` (–∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏)

### 2.2 –î–æ–±–∞–≤—å—Ç–µ —Å—Ç–æ–ª–±—Ü—ã

| –°—Ç–æ–ª–±–µ—Ü | –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | –û–ø–∏—Å–∞–Ω–∏–µ           | –ü—Ä–∏–º–µ—Ä          |
| ------- | ---------- | ------------------ | --------------- |
| id      | Int        | ID –∑–∞–ø–∏—Å–∏ (–∫–ª—é—á)   | 1               |
| param   | Text       | –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ | selectedGroupID |
| value   | Text       | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ | 1               |

### 2.3 –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö

| id | param           | value |
|----|-----------------|-------|
| 1  | selectedGroupID | 1     |

**–í–∞–∂–Ω–æ:** –ó–Ω–∞—á–µ–Ω–∏–µ `value` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **ID —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –≥—Ä—É–ø–ø—ã** –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `Device_groups`.

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –¢–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ Grist –µ—Å—Ç—å –¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã —Å —Ç–æ—á–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏:
- [ ] `Device_groups` (—Å –∑–∞–≥–ª–∞–≤–Ω–æ–π D)
- [ ] `SYSTEM` (–∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –î–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

- [ ] –í `Device_groups` –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞
- [ ] –í `SYSTEM` –µ—Å—Ç—å –∑–∞–ø–∏—Å—å —Å `param = 'selectedGroupID'`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –°—Å—ã–ª–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

- [ ] `Device_groups.parent_id` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `Device_groups.id` (–∏–ª–∏ 0)
- [ ] `SYSTEM.value` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ID –≥—Ä—É–ø–ø—ã

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–∏–¥–∂–µ—Ç–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:

1. –î–æ–±–∞–≤—å—Ç–µ Custom Widget –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
2. URL –≤–∏–¥–∂–µ—Ç–∞: –ø—É—Ç—å –∫ `index.html`
3. –í–∏–¥–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `grist.docApi.fetchTable()`

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í–∏–¥–∂–µ—Ç —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Å—Ç—É–ø `full` –¥–ª—è —á—Ç–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü —á–µ—Ä–µ–∑ docApi.

---

## üîç Troubleshooting

### –û—à–∏–±–∫–∞: KeyError 'Device_groups'

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–∞—á–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã –≤ Grist
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ—á–Ω–æ `Device_groups`

### –û—à–∏–±–∫–∞: KeyError 'SYSTEM'

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–∞—á–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã –≤ Grist
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ—á–Ω–æ `SYSTEM`

### –í–∏–¥–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ¬´–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è¬ª

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–∞–±–ª–∏—Ü–∞ `Device_groups` –ø—É—Å—Ç–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –≥—Ä—É–ø–ø—É –≤ `Device_groups`

### –í–∏–¥–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ¬´–ù–µ –≤—ã–±—Ä–∞–Ω–æ¬ª

**–ü—Ä–∏—á–∏–Ω–∞:** –í —Ç–∞–±–ª–∏—Ü–µ `SYSTEM` –Ω–µ—Ç –∑–∞–ø–∏—Å–∏ —Å `param = 'selectedGroupID'`

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–ø–∏—Å—å –≤ `SYSTEM`:
   - `param` = `selectedGroupID`
   - `value` = ID –≥—Ä—É–ø–ø—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1`)

### –ü—Ä–∏ –∫–ª–∏–∫–µ –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∏–¥–∂–µ—Ç –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø `full`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ `SYSTEM`

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –ò–º–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü **—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É**
- `Device_groups` - —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã
- `SYSTEM` - –∑–∞–≥–ª–∞–≤–Ω—ã–º–∏ –±—É–∫–≤–∞–º–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∏–º–µ–Ω–∞—Ö –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
- –î–ª—è —Ä–∞–±–æ—Ç—ã –∏–µ—Ä–∞—Ä—Ö–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `parent_id` –≤ `Device_groups`
- `parent_id = 0` –æ–∑–Ω–∞—á–∞–µ—Ç –∫–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª
