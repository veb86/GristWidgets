# BDTree Widget

–í–∏–¥–∂–µ—Ç –¥–ª—è Grist –¥–ª—è –≤—ã–±–æ—Ä–∞ –≥—Ä—É–ø–ø—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ –≤–∏–¥–µ –¥–µ—Ä–µ–≤–∞ —Å –∑–∞–ø–∏—Å—å—é –≤ `SYSTEM.selectedGroupID`.

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Grist

–í–∏–¥–∂–µ—Ç —Ç—Ä–µ–±—É–µ—Ç **–¥–≤–µ —Ç–∞–±–ª–∏—Ü—ã**:

| –ò–º—è —Ç–∞–±–ª–∏—Ü—ã      | –û–ø–∏—Å–∞–Ω–∏–µ                    |
| ---------------- | --------------------------- |
| `Device_groups`  | –ì—Ä—É–ø–ø—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (–∏–µ—Ä–∞—Ä—Ö–∏—è) |
| `SYSTEM`         | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–≤—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã)    |

üìñ –ü–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ç–∞–±–ª–∏—Ü —Å–º. –≤ [TABLES_SETUP.md](TABLES_SETUP.md)

### 2. –î–æ–±–∞–≤—å—Ç–µ –≤–∏–¥–∂–µ—Ç

1. –î–æ–±–∞–≤—å—Ç–µ Custom Widget —Å URL –Ω–∞ `index.html`
2. –í–∏–¥–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç –¥–µ—Ä–µ–≤–æ

### 3. –í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É

–ö–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —É–∑–ª—É –¥–µ—Ä–µ–≤–∞ ‚Äî –≤–∏–¥–∂–µ—Ç –∑–∞–ø–∏—à–µ—Ç ID –≥—Ä—É–ø–ø—ã –≤ `SYSTEM.selectedGroupID`

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–í–∏–¥–∂–µ—Ç **BDTree** –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `Device_groups` –≤ –≤–∏–¥–µ –¥–µ—Ä–µ–≤–∞
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—é —á–µ—Ä–µ–∑ `parent_id`
- –í—ã–±–∏—Ä–∞—Ç—å –≥—Ä—É–ø–ø—É –∫–ª–∏–∫–æ–º –ø–æ —É–∑–ª—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤—ã–±–æ—Ä –≤ `SYSTEM.selectedGroupID`

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

### Device_groups

| –ü–æ–ª–µ       | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| ---------- | ------- | ---------------------------------- |
| id         | INTEGER | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≥—Ä—É–ø–ø—ã               |
| manualSort | INTEGER | –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏                 |
| parent_id  | INTEGER | –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –≥—Ä—É–ø–ø–∞ (0 = –∫–æ—Ä–Ω–µ–≤–∞—è) |
| code       | TEXT    | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–¥ –≥—Ä—É–ø–ø—ã             |
| name       | TEXT    | –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –≥—Ä—É–ø–ø—ã            |

### SYSTEM

| –ü–æ–ª–µ  | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ           |
| ----- | ------- | ------------------ |
| id    | INTEGER | ID –∑–∞–ø–∏—Å–∏          |
| param | TEXT    | –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ |
| value | TEXT    | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ |

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
widget/BDTree/
‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ style.css          # –°—Ç–∏–ª–∏ –¥–µ—Ä–µ–≤–∞
‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îú‚îÄ‚îÄ app.js             # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ config.js          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ grist-api.js       # –ú–æ–¥—É–ª—å Grist API
‚îÇ   ‚îú‚îÄ‚îÄ tree.js            # –ú–æ–¥—É–ª—å –¥–µ—Ä–µ–≤–∞ (–ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏)
‚îÇ   ‚îî‚îÄ‚îÄ ui.js              # –ú–æ–¥—É–ª—å UI (–æ—Ç—Ä–∏—Å–æ–≤–∫–∞, —Å–æ–±—ã—Ç–∏—è)
‚îú‚îÄ‚îÄ grist-plugin-api.js    # Grist Widget API
‚îú‚îÄ‚îÄ index.html             # HTML-—Ä–∞–∑–º–µ—Ç–∫–∞
‚îú‚îÄ‚îÄ widget.json            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞
‚îú‚îÄ‚îÄ README.md              # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ TABLES_SETUP.md        # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ç–∞–±–ª–∏—Ü
```

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞

- –ö–æ—Ä–Ω–µ–≤—ã–µ —É–∑–ª—ã: `parent_id = 0`
- –î–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã: `parent_id = id —Ä–æ–¥–∏—Ç–µ–ª—è`
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `manualSort` –≤–Ω—É—Ç—Ä–∏ —É—Ä–æ–≤–Ω—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª—é–±–æ–π –≥–ª—É–±–∏–Ω—ã –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏
- –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –≤–µ—Ç–æ–∫

### –ü—Ä–∏–º–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

```
üìÅ lighting ‚Äî –û—Å–≤–µ—â–µ–Ω–∏–µ (2)
  ‚ñ∂ üìÅ luminaires ‚Äî –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏
  ‚ñ∂ üìÅ lamps ‚Äî –õ–∞–º–ø—ã

üìÅ protection ‚Äî –ó–∞—â–∏—Ç–∞ (1)
  ‚ñ∂ üìÅ breakers ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–∏

üìÅ cables ‚Äî –ö–∞–±–µ–ª–∏
```

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

- **–ö–ª–∏–∫ –ø–æ —É–∑–ª—É**: –≤—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã, –∑–∞–ø–∏—Å—å –≤ `SYSTEM`
- **–ö–ª–∏–∫ –ø–æ ‚ñ∂**: —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –≤–µ—Ç–∫–∏
- **–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –∏–∑ `SYSTEM.selectedGroupID`

## üé® –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø–µ
- –î–µ—Ä–µ–≤–æ —Å –∏–∫–æ–Ω–∫–∞–º–∏ –ø–∞–ø–æ–∫/—Ñ–∞–π–ª–æ–≤
- –°—á—ë—Ç—á–∏–∫ –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–í–∏–¥–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏:
- –°–æ—Å—Ç–∞–≤–∞ —Ç–∞–±–ª–∏—Ü—ã `Device_groups`
- –ó–Ω–∞—á–µ–Ω–∏—è `SYSTEM.selectedGroupID`

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

| –°–∏—Ç—É–∞—Ü–∏—è | –°–æ–æ–±—â–µ–Ω–∏–µ |
| -------- | --------- |
| –ü—É—Å—Ç–∞—è `Device_groups` | ¬´–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è¬ª |
| –í—ã–±—Ä–∞–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞ —É–¥–∞–ª–µ–Ω–∞ | ¬´–í—ã–±—Ä–∞–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞ —É–¥–∞–ª–µ–Ω–∞¬ª |
| –¶–∏–∫–ª –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏ | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å |

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ç–∫—Ä–æ–π—Ç–µ `test-bdtree-widget.html` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–º–∏.

## üìù –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö

### Device_groups

| id | manualSort | parent_id | code       | name                       |
|----|------------|-----------|------------|----------------------------|
| 1  | 1          | 0         | lighting   | –û—Å–≤–µ—â–µ–Ω–∏–µ                  |
| 2  | 2          | 0         | protection | –ó–∞—â–∏—Ç–∞                     |
| 3  | 3          | 0         | cables     | –ö–∞–±–µ–ª–∏                     |
| 4  | 1          | 1         | luminaires | –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏                |
| 5  | 2          | 1         | lamps      | –õ–∞–º–ø—ã                      |
| 6  | 1          | 2         | breakers   | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–∏ |

### SYSTEM

| id | param           | value |
|----|-----------------|-------|
| 1  | selectedGroupID | 1     |

## üîó –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| [TABLES_SETUP.md](TABLES_SETUP.md) | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ç–∞–±–ª–∏—Ü |

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

–ö–æ–¥ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:
- –ü–æ–∏—Å–∫ –ø–æ –¥–µ—Ä–µ–≤—É
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
- Drag-and-drop –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏
- –ú–∞—Å—Å–æ–≤—ã–π –≤—ã–±–æ—Ä

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–í–∏–¥–∂–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ Grist.
