<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Виджет-органайзер test123</title>
    <!-- Подключение стилей для виджета-органайзера -->
    <link rel="stylesheet" href="./css/style.css">

    <!-- Загрузка внешних библиотек -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://unpkg.com/tabulator-tables@5.4.4/dist/js/tabulator.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/tabulator-tables@5.4.4/dist/css/tabulator.min.css">
</head>
<body>
    <!-- Основной контейнер с flexbox-версткой для разделения экрана на две колонки -->
    <!-- Делит интерфейс на левую колонку (50%) и правую колонку (50%) -->
    <div class="main-container">
        <!-- Левая колонка (50%) - виджет table1 -->
        <div id="left-column" class="column">
            <h4>Table 1 Widget</h4>
            <iframe id="table1-frame" 
                    src="../table1/index.html" 
                    width="100%" 
                    height="100%" 
                    frameborder="0">
            </iframe>
        </div>

        <!-- Правая колонка (50%) - виджет table2 -->
        <div id="right-column" class="column">
            <h4>Table 2 Widget</h4>
            <iframe id="table2-frame" 
                    src="../table2/index.html" 
                    width="100%" 
                    height="100%" 
                    frameborder="0">
            </iframe>
        </div>
    </div>

    <!-- Глобальный объект для API взаимодействия между компонентами -->
    <script>
        // Глобальный объект для API взаимодействия между компонентами
        window.AppHost = {
            subscribers: [],

            // Метод получения данных
            getData() {
                // Возвращаем данные из Grist API
                if (window.grist) {
                    return window.grist.getTable();
                }
                return null;
            },

            // Метод подписки на изменения данных
            subscribe(callback) {
                this.subscribers.push(callback);

                // Возвращаем функцию отписки
                return () => {
                    const index = this.subscribers.indexOf(callback);
                    if (index > -1) {
                        this.subscribers.splice(index, 1);
                    }
                };
            },

            // Метод отправки событий
            sendEvent(name, data) {
                // Отправляем событие через CustomEvent
                const event = new CustomEvent(name, { detail: data });
                document.dispatchEvent(event);
            },

            // Метод вызова подписчиков при изменении данных
            notifySubscribers(data) {
                this.subscribers.forEach(callback => {
                    try {
                        callback(data);
                    } catch (error) {
                        console.error('Error in subscriber callback:', error);
                    }
                });
            },

            // Метод для установки выбранных строк
            setSelectedRows(rowIds) {
                if (window.grist) {
                    window.grist.setSelectedRows(rowIds);
                }
            },

            // Метод для установки позиции курсора
            setCursorPos(pos) {
                if (window.grist) {
                    window.grist.setCursorPos(pos);
                }
            }
        };

        // Обработка сообщений от Grist API
        if (window.grist) {
            window.grist.ready();
            window.grist.onRecords(function(records) {
                window.AppHost.notifySubscribers({ type: 'records', data: records });
            });
        }
    </script>

    <!-- Модуль инициализации -->
    <script src="./js/init.js"></script>
</body>
</html>