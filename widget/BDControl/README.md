# BDControl Widget

–í–∏–¥–∂–µ—Ç –¥–ª—è Grist –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –≥—Ä—É–ø–ø–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —É—á—ë—Ç–æ–º –∏–µ—Ä–∞—Ä—Ö–∏–∏.

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã –≤ Grist

–í–∏–¥–∂–µ—Ç —Ç—Ä–µ–±—É–µ—Ç **—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã** —Å **—Ç–æ—á–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏**:

| –ò–º—è —Ç–∞–±–ª–∏—Ü—ã      | –û–ø–∏—Å–∞–Ω–∏–µ                    |
| ---------------- | --------------------------- |
| `Device_groups`  | –ì—Ä—É–ø–ø—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (–∏–µ—Ä–∞—Ä—Ö–∏—è) |
| `Device`         | –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞                  |
| `SYSTEM`         | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (–≤—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã)    |

üìñ –ü–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ç–∞–±–ª–∏—Ü —Å–º. –≤ [TABLES_SETUP.md](TABLES_SETUP.md)

### 2. –î–æ–±–∞–≤—å—Ç–µ –≤–∏–¥–∂–µ—Ç

1. –î–æ–±–∞–≤—å—Ç–µ Custom Widget —Å URL –Ω–∞ `index.html`
2. –í–∏–¥–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –¥–∞–Ω–Ω—ã–µ

### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã

–í —Ç–∞–±–ª–∏—Ü–µ `SYSTEM` —Å–æ–∑–¥–∞–π—Ç–µ –∑–∞–ø–∏—Å—å:
- `param` = `selectedGroupID`
- `value` = ID –≥—Ä—É–ø–ø—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1`)

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–í–∏–¥–∂–µ—Ç **BDControl** –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ß–∏—Ç–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≥—Ä—É–ø–ø—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `SYSTEM`
- –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `device`
- –£—á–∏—Ç—ã–≤–∞—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—é –≥—Ä—É–ø–ø –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `device_groups`
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø–µ –∏ –µ—ë –¥–æ—á–µ—Ä–Ω–∏–º –≥—Ä—É–ø–ø–∞–º

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

### Device_groups

| –ü–æ–ª–µ       | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| ---------- | ------- | ---------------------------------- |
| id         | INTEGER | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≥—Ä—É–ø–ø—ã               |
| manualSort | INTEGER | –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏                 |
| parent_id  | INTEGER | –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –≥—Ä—É–ø–ø–∞ (0 = –∫–æ—Ä–Ω–µ–≤–∞—è) |
| code       | TEXT    | –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–¥ –≥—Ä—É–ø–ø—ã             |
| name       | TEXT    | –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –≥—Ä—É–ø–ø—ã            |

### Device

| –ü–æ–ª–µ                 | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ                |
| -------------------- | ------- | ----------------------- |
| id                   | INTEGER | ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞           |
| name                 | TEXT    | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ            |
| brand                | TEXT    | –ú–æ–¥–µ–ª—å                  |
| factoryname          | TEXT    | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å           |
| devgroup_id          | INTEGER | ID –≥—Ä—É–ø–ø—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞    |
| gristHelper_Display2 | TEXT    | –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –≥—Ä—É–ø–ø—ã |
| unit                 | TEXT    | –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è       |
| count                | TEXT    | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ              |
| note                 | TEXT    | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ              |

### SYSTEM

| –ü–æ–ª–µ  | –¢–∏–ø     | –û–ø–∏—Å–∞–Ω–∏–µ           |
| ----- | ------- | ------------------ |
| id    | INTEGER | ID –∑–∞–ø–∏—Å–∏          |
| param | TEXT    | –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ |
| value | TEXT    | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ |

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
widget/BDControl/
‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ style.css          # –°—Ç–∏–ª–∏
‚îú‚îÄ‚îÄ js/
‚îÇ   ‚îú‚îÄ‚îÄ app.js             # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ config.js          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞)
‚îÇ   ‚îú‚îÄ‚îÄ grist-api.js       # –ú–æ–¥—É–ª—å Grist API (docApi.fetchTable)
‚îÇ   ‚îî‚îÄ‚îÄ ui.js              # –ú–æ–¥—É–ª—å UI (–æ—Ç—Ä–∏—Å–æ–≤–∫–∞, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
‚îú‚îÄ‚îÄ grist-plugin-api.js    # Grist Widget API
‚îú‚îÄ‚îÄ index.html             # HTML-—Ä–∞–∑–º–µ—Ç–∫–∞
‚îú‚îÄ‚îÄ widget.json            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∏–¥–∂–µ—Ç–∞
‚îú‚îÄ‚îÄ README.md              # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ SETUP.md               # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
‚îî‚îÄ‚îÄ TABLES_SETUP.md        # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ç–∞–±–ª–∏—Ü
```

## üéØ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏

–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –≥—Ä—É–ø–ø—ã –≤–∏–¥–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑:
- –í—ã–±—Ä–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã
- –í—Å–µ—Ö –¥–æ—á–µ—Ä–Ω–∏—Ö –≥—Ä—É–ø–ø (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ)

**–ü—Ä–∏–º–µ—Ä:**
```
–û—Å–≤–µ—â–µ–Ω–∏–µ (1)
 ‚îú‚îÄ –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏ (4)
 ‚îî‚îÄ –õ–∞–º–ø—ã (5)
```
–ü—Ä–∏ –≤—ã–±–æ—Ä–µ –≥—Ä—É–ø–ø—ã "–û—Å–≤–µ—â–µ–Ω–∏–µ (1)" –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–∑ –≥—Ä—É–ø–ø 1, 4 –∏ 5.

### –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

–ö–ª–∏–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É —Å—Ç–æ–ª–±—Ü–∞ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ:
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ –º–µ–Ω—è–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (asc/desc)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —á–∏—Å–ª–æ–≤–∞—è –∏ —Å—Ç—Ä–æ–∫–æ–≤–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

| –°–∏—Ç—É–∞—Ü–∏—è                    | –°–æ–æ–±—â–µ–Ω–∏–µ                    |
| --------------------------- | ---------------------------- |
| –ù–µ –≤—ã–±—Ä–∞–Ω `selectedGroupID` | ¬´–ì—Ä—É–ø–ø–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞¬ª          |
| –ì—Ä—É–ø–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞           | ¬´–í—ã–±—Ä–∞–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞¬ª|
| –ù–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ –≥—Ä—É–ø–ø–µ      | ¬´–í –¥–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø–µ –Ω–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤¬ª |

## üé® –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã
- –°—á—ë—Ç—á–∏–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –¢–∞–±–ª–∏—Ü–∞ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:
  - –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ
  - –ú–æ–¥–µ–ª—å
  - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å
  - –ï–¥. –∏–∑–º.
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
  - –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ
  - –ì—Ä—É–ø–ø–∞

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–í–∏–¥–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏:
- `SYSTEM.value` (param = selectedGroupID)
- –°–æ—Å—Ç–∞–≤–∞ —Ç–∞–±–ª–∏—Ü—ã `device`
- –ò–µ—Ä–∞—Ä—Ö–∏–∏ `device_groups`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–û—Ç–∫—Ä–æ–π—Ç–µ `test-bdcontrol-widget.html` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–º–∏.

## üìù –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

| selectedGroupID | –û—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞         |
| --------------- | ------------------------------- |
| 1 (lighting)    | –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏ + –õ–∞–º–ø—ã             |
| 4 (luminaires)  | –¢–æ–ª—å–∫–æ –°–≤–µ—Ç–∏–ª—å–Ω–∏–∫–∏              |
| 5 (lamps)       | –¢–æ–ª—å–∫–æ –õ–∞–º–ø—ã                    |
| 2 (protection)  | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–∏      |
| 3 (cables)      | –ö–∞–±–µ–ª–∏                          |

## üîó –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| [TABLES_SETUP.md](TABLES_SETUP.md) | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é —Ç–∞–±–ª–∏—Ü –≤ Grist |
| [SETUP.md](SETUP.md) | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –≤–∏–¥–∂–µ—Ç–∞ |

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ

–ö–æ–¥ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:
- –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –ü–æ–∏—Å–∫ –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
- –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ –ø–æ–ª—è

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–í–∏–¥–∂–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ Grist.
