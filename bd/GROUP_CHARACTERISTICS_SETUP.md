# Настройка таблицы Group_Characteristics для BDControl

## Структура таблицы

Таблица `Group_Characteristics` связывает группы устройств с их характеристиками и управляет видимостью столбцов.

### Поля таблицы

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | Integer | Уникальный идентификатор записи |
| `manualSort` | Integer | Порядок сортировки записей в Grist |
| `group_id` | Reference:Device_groups | ID группы устройств, для которой настроены характеристики |
| `characteristic_id` | Reference:Characteristics | ID характеристики |
| `is_visible` | Bool | Видимость столбца в таблице (true/false) |
| `sort_order` | Integer | Порядок отображения столбца в таблице |

## Пример настройки для разных групп

### Светильники (group_id = 4)

| characteristic_id | Характеристика | is_visible | sort_order |
|-------------------|----------------|------------|------------|
| 1 | Мощность | true | 1 |
| 2 | Напряжение питания | true | 2 |
| 3 | Световой поток | true | 3 |
| 4 | Температура | true | 4 |

### Лампы (group_id = 5)

| characteristic_id | Характеристика | is_visible | sort_order |
|-------------------|----------------|------------|------------|
| 1 | Мощность | true | 1 |
| 3 | Световой поток | true | 2 |
| 4 | Температура | true | 3 |

**Обратите внимание:** Для ламп не показывается "Напряжение питания", поэтому запись с `characteristic_id=2` отсутствует.

### Автоматические выключатели (group_id = 6)

Для автоматов нужно создать свои характеристики в таблице `Characteristics`:

| id | code | name | data_type | unit |
|----|------|------|-----------|------|
| 5 | rated_current | Номинальный ток | float | А |
| 6 | poles | Полюсность | integer | - |
| 7 | characteristic | Характеристика | string | - |

И добавить связи в `Group_Characteristics`:

| group_id | characteristic_id | is_visible | sort_order |
|----------|-------------------|------------|------------|
| 6 | 5 | true | 1 |
| 6 | 6 | true | 2 |
| 6 | 7 | true | 3 |

## Как настроить в Grist

1. **Создайте таблицу `Group_Characteristics`** с указанными выше полями

2. **Добавьте связи:**
   - `group_id` → Reference на таблицу `Device_groups`
   - `characteristic_id` → Reference на таблицу `Characteristics`

3. **Настройте видимость:**
   - Установите `is_visible = true` для столбцов которые должны отображаться
   - Установите `is_visible = false` для скрытия столбца

4. **Настройте порядок:**
   - Изменяйте `sort_order` для управления порядком столбцов
   - Меньшие значения отображаются слева

5. **Импортируйте данные из CSV:**
   - Используйте файл `Group_Characteristics.csv` для начального заполнения

## Как это работает в виджете

1. При выборе группы устройств виджет получает `selectedGroupID` из таблицы `SYSTEM`

2. Виджет запрашивает все записи из `Group_Characteristics` где `group_id = selectedGroupID`

3. Для каждой записи получается информация о характеристике из таблицы `Characteristics`

4. Динамически формируются столбцы таблицы только для видимых характеристик (`is_visible = true`)

5. Значения характеристик для каждого устройства берутся из таблицы `Device_characteristics`

## Управление настройками через виджет (будущая функция)

В дальнейшем планируется добавить UI для управления видимостью столбцов прямо из виджета:
- Чекбоксы для включения/выключения видимости столбцов
- Drag-and-drop для изменения порядка столбцов
- Сохранение настроек для каждой группы отдельно
