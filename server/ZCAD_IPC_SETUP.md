# Настройка IPC сервера ZCAD

## Проблема
Ошибка `Connection refused - is ZCAD running?` означает что IPC TCP сервер ZCAD не запущен.

## Решение

### Шаг 1: Запустите ZCAD

Откройте ZCAD.

### Шаг 2: Запустите IPC сервер в ZCAD

В командной строке ZCAD введите:

```
IPCStart
```

Или с параметрами:

```
IPCStart 127.0.0.1 7777
```

Где:
- `127.0.0.1` - хост (localhost)
- `7777` - порт для TCP соединений

### Шаг 3: Проверьте статус

```
IPCStatus
```

Должно появиться сообщение:
```
IPC server is running on 127.0.0.1:7777
```

### Шаг 4: Проверьте соединение из Python

```bash
cd c:\zcad\GristWidgets\server
..\python\python.exe zcad_tcp_client.py
```

Должно появиться:
```
ZCAD TCP Client - тестовый режим
----------------------------------------
Проверка подключения...
Ping: {
  "id": "cmd-0001",
  "status": "ok",
  "result": "pong"
}

ZCAD доступен!
```

## Проверка брандмауэра

Если IPC сервер не запускается, проверьте брандмауэр Windows:

1. Откройте "Брандмауэр Защитника Windows"
2. Разрешите входящие подключения на порт 7777
3. Или временно отключите брандмауэр для тестирования

## Остановка IPC сервера

В командной строке ZCAD:

```
IPCStop
```

## Логи ZCAD

Проверьте логи ZCAD на наличие ошибок IPC:
- Окно истории сообщений ZCAD
- Файл лога ZCAD (если включено логирование)

## Примечания

- IPC сервер работает только когда ZCAD запущен
- При закрытии ZCAD IPC сервер автоматически останавливается
- Для работы пакетного режима (`BEGIN_BATCH`/`END_BATCH`) требуется чтобы `uzvipcintegration.pas` был загружен в ZCAD
